<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><title>Rails 3 remote update form</title><link href="http://fonts.googleapis.com/css?family=Droid+Sans:400,700|Bitter:400,700,400italic|Open+Sans:300italic,400italic,700italic,400,300,700" media="screen" rel="stylesheet" type="text/css" /><link href="../assets/stylesheets/all-f5ec2720.css" media="screen" rel="stylesheet" type="text/css" /><script src="../assets/javascripts/all-eca7008a.js" type="text/javascript"></script></head><body class="x2010 x2010_rails-3-remote-update-form"><div class="navbar navbar-default"><div class="navbar-collapse collapse navbar-responsive-collapse"><div class="container"><ul class="nav navbar-nav"><li><a class="navbar-brand" href="/">Blog</a></li><li><a class="navbar-brand" href="/about.html">About</a></li><li><a class="navbar-brand" href="/projects.html">Projects</a></li><li><a class="navbar-brand" href="/talks.html">Talks</a></li></ul></div></div></div><div class="container"><article class="post"><div class="page-header"><div class="row"><div class="col-md-10"><h1>Rails 3 remote update form</h1></div><div class="col-md-2 post-date"><time datetime="2010-08-17">Aug 17, 2010</time></div></div></div><div class="alert alert-info">This article was originally
<a href="http://tumblr.teamon.eu/post/967005738/rails-3-remote-update-form">published at Tumblr</a>.</div><div class="lead"><p><a href="http://rubyonrails.org">Rails 3</a> brings some nice <a href="http://www.simonecarletti.com/blog/2010/06/unobtrusive-javascript-in-rails-3/">unobstrusive javascript</a>. This very short tutorial will show how to make simple yet powerful ajax update form.</p>

<p>First, grab <a href="http://github.com/rails/jquery-ujs">jquery-ujs</a> file (or gem). Next, create some model and REST controller.</p>

<h3>Controller needs a small change:</h3>
<pre class="highlight ruby"><span class="k">class</span> <span class="nc">FooController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="k">def</span> <span class="nf">update</span>
    <span class="vi">@foo</span> <span class="o">=</span> <span class="no">Foo</span><span class="p">.</span><span class="nf">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
    <span class="k">if</span> <span class="vi">@foo</span><span class="p">.</span><span class="nf">update_attributes</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:foo</span><span class="o">]</span><span class="p">)</span>
      <span class="n">render</span> <span class="ss">:json</span> <span class="o">=&gt;</span> <span class="s2">"Foo successfully updated"</span>
    <span class="k">else</span>
      <span class="n">render</span> <span class="ss">:json</span> <span class="o">=&gt;</span> <span class="vi">@foo</span><span class="p">.</span><span class="nf">errors</span><span class="p">,</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="mi">406</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
<p>That&rsquo;s pretty self explaining: when object is valid send notice message, else send errors as json array.</p>

<h3>View:</h3>
<pre class="highlight haml"><span class="p">=</span> <span class="n">form_for</span> <span class="vi">@foo</span><span class="p">,</span> <span class="ss">:remote</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="k">do</span>
  <span class="p">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">text_field</span> <span class="ss">:name</span>
  <span class="p">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">submit</span>
</pre>
<p>Only the <code>:remote =&gt; true</code> part is important.</p>

<h3>Some JavaScript</h3>
<pre class="highlight javascript"><span class="nx">$</span><span class="p">(</span><span class="s2">"form[data-remote]"</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">form</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">form</span><span class="p">)</span>
    <span class="kd">var</span> <span class="nx">loading</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"&lt;div class='form_loading'&gt;&lt;/div&gt;"</span><span class="p">),</span>
        <span class="nx">notice</span>  <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"&lt;div class='form_notice'&gt;&lt;/div&gt;"</span><span class="p">),</span>
        <span class="nx">errors</span>  <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"&lt;ul class='form_errore'&gt;&lt;/ul&gt;"</span><span class="p">);</span>

    <span class="nx">f</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">loading</span><span class="p">.</span><span class="nx">hide</span><span class="p">())</span>
    <span class="nx">f</span><span class="p">.</span><span class="nx">prepend</span><span class="p">(</span><span class="nx">notice</span><span class="p">.</span><span class="nx">hide</span><span class="p">())</span>
    <span class="nx">f</span><span class="p">.</span><span class="nx">prepend</span><span class="p">(</span><span class="nx">errors</span><span class="p">.</span><span class="nx">hide</span><span class="p">())</span>

    <span class="c1">// hide errors and notice and show loading indicator when loading
</span>    <span class="nx">f</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">"ajax:loading"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="nx">errors</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">notice</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
        <span class="nx">loading</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
    <span class="p">})</span>
    <span class="c1">// hide loading indicator when finished
</span>    <span class="nx">f</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">"ajax:complete"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">loading</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
    <span class="p">})</span>
    <span class="c1">// show notice on success
</span>    <span class="nx">f</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">"ajax:success"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ev</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">xhr</span><span class="p">){</span>
        <span class="nx">notice</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">data</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
    <span class="p">})</span>
    <span class="c1">// show errors on failure
</span>    <span class="nx">f</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">"ajax:failure"</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ev</span><span class="p">,</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">status</span><span class="p">){</span>
        <span class="nx">errors</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">parseJSON</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">){</span>
            <span class="nx">errors</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">"&lt;li&gt;"</span> <span class="o">+</span> <span class="nx">msg</span> <span class="o">+</span> <span class="s2">"&lt;/li&gt;"</span><span class="p">)</span>
        <span class="p">})</span>
        <span class="nx">errors</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
    <span class="p">})</span>
<span class="p">})</span>
</pre>
<p>This code will take remote form and register callbacks for showing loader, notice message and errors list.</p>

<p>And that&rsquo;s all, it simply works. And yes, you have to write CSS on your own ;]</p>
</div></article><div class="page-header"><h2>Comments</h2></div><div class="alert alert-info">Please comment at the <a href="http://tumblr.teamon.eu/post/967005738/rails-3-remote-update-form">original post</a>.</div><ul class="pager"><li class="next"><a href="/2010/quickly-get-some-random-image-placeholders">Older post →</a></li><li class="previous"><a href="/2010/run-irb-from-file">← Newer post</a></li></ul></div><footer><div class="container"><div class="page-header"></div><div class="row"><div class="col-md-12"><ul class="list-unstyled"><li class="pull-right"><a href="#top">Back to top ↑</a></li><li><a href="/">Blog</a></li><li><a href="/about.html">About</a></li><li><a href="/projects.html">Projects</a></li><li><a href="/talks.html">Talks</a></li><li>|</li><li><a href="http://github.com/teamon">GitHub</a></li><li><a href="http://twitter.com/iteamon">Twitter</a></li><li><a href="http://monterail.com">Monterail</a></li><li><a href="http://codetunes.com">Codetunes</a></li></ul></div></div><div class="row"><div class="col-md-12"><p>Copyright 2007-2014 &mdash; Tymon Tobolski <br />Based on <a href="http://bootswatch.com/lumen/">Lumen Bootswatch</a>. Web fonts from <a href="http://www.google.com/webfonts">Google</a>. </p></div></div></div></footer></body></html>