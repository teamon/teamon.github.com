<!DOCTYPE html><html><head><meta charset="utf-8" /><meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" /><title>Better (scoped) rails engines routing</title><link href="http://fonts.googleapis.com/css?family=Droid+Sans:400,700|Bitter:400,700,400italic|Open+Sans:300italic,400italic,700italic,400,300,700" media="screen" rel="stylesheet" type="text/css" /><link href="../assets/stylesheets/all-f5ec2720.css" media="screen" rel="stylesheet" type="text/css" /><script src="../assets/javascripts/all-eca7008a.js" type="text/javascript"></script></head><body class="x2010 x2010_better-scoped-rails-engines-routing"><div class="navbar navbar-default"><div class="navbar-collapse collapse navbar-responsive-collapse"><div class="container"><ul class="nav navbar-nav"><li><a class="navbar-brand" href="/">Blog</a></li><li><a class="navbar-brand" href="/about.html">About</a></li><li><a class="navbar-brand" href="/projects.html">Projects</a></li><li><a class="navbar-brand" href="/talks.html">Talks</a></li></ul></div></div></div><div class="container"><article class="post"><div class="page-header"><div class="row"><div class="col-md-10"><h1>Better (scoped) rails engines routing</h1></div><div class="col-md-2 post-date"><time datetime="2010-08-03">Aug  3, 2010</time></div></div></div><div class="alert alert-info">This article was originally
<a href="http://tumblr.teamon.eu/post/898063470/better-scoped-rails-engines-routing">published at Tumblr</a>.</div><div class="lead"><p>Rails engines are really great, but they are missing one thing - putting in router scope. Fortunately, this can be easily fixed.</p>

<p>Instead of engine&rsquo;s <code>config/routes.rb</code> file put all router stuff in <code>lib/engine.rb</code> like that:</p>
<pre class="highlight ruby"><span class="c1"># my_engine/lib/engine.rb</span>

<span class="nb">require</span> <span class="s2">"my_engine"</span>
<span class="nb">require</span> <span class="s2">"rails"</span>

<span class="k">module</span> <span class="nn">MyEngine</span>
  <span class="k">class</span> <span class="nc">Engine</span> <span class="o">&lt;</span> <span class="no">Rails</span><span class="o">::</span><span class="no">Engine</span>
  <span class="k">end</span>

  <span class="k">module</span> <span class="nn">Routes</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">draw</span><span class="p">(</span><span class="n">map</span><span class="p">)</span>
      <span class="n">map</span><span class="p">.</span><span class="nf">instance_exec</span> <span class="k">do</span>
        <span class="n">match</span> <span class="s2">"/my_engine"</span><span class="p">,</span> <span class="ss">:to</span> <span class="o">=&gt;</span> <span class="s2">"my_engine#foo"</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre><pre class="highlight ruby"><span class="c1"># my_app/config/routes.rb</span>

<span class="no">MyApp</span><span class="o">::</span><span class="no">Application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="no">MyEngine</span><span class="o">::</span><span class="no">Routes</span><span class="p">.</span><span class="nf">draw</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>
<span class="k">end</span>
</pre><pre class="highlight shell"><span class="gp">$ </span>rake routes
my_engine  /my_engine <span class="o">{</span>:controller<span class="o">=</span>&gt;<span class="s2">"my_engine"</span>, :action<span class="o">=</span>&gt;<span class="s2">"foo"</span><span class="o">}</span>
</pre>
<p>And now it is possible to add scope:</p>
<pre class="highlight ruby"><span class="c1"># my_engine/lib/engine.rb</span>

<span class="nb">require</span> <span class="s2">"my_engine"</span>
<span class="nb">require</span> <span class="s2">"rails"</span>

<span class="k">module</span> <span class="nn">MyEngine</span>
  <span class="k">class</span> <span class="nc">Engine</span> <span class="o">&lt;</span> <span class="no">Rails</span><span class="o">::</span><span class="no">Engine</span>
  <span class="k">end</span>

  <span class="k">module</span> <span class="nn">Routes</span>
    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">draw</span><span class="p">(</span><span class="n">map</span><span class="p">)</span>
      <span class="n">map</span><span class="p">.</span><span class="nf">instance_exec</span> <span class="k">do</span>
        <span class="n">match</span> <span class="s2">"/my_engine"</span><span class="p">,</span> <span class="ss">:to</span> <span class="o">=&gt;</span> <span class="s2">"my_engine#foo"</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre><pre class="highlight ruby"><span class="c1"># my_app/config/routes.rb</span>

<span class="no">MyApp</span><span class="o">::</span><span class="no">Application</span><span class="p">.</span><span class="nf">routes</span><span class="p">.</span><span class="nf">draw</span> <span class="k">do</span>
  <span class="n">scope</span> <span class="s2">"bar"</span> <span class="k">do</span>
    <span class="no">MyEngine</span><span class="o">::</span><span class="no">Routes</span><span class="p">.</span><span class="nf">draw</span><span class="p">(</span><span class="nb">self</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre><pre class="highlight shell"><span class="gp">$ </span>rake routes
bar_my_engine  /bar/my_engine <span class="o">{</span>:controller<span class="o">=</span>&gt;<span class="s2">"my_engine"</span>, :action<span class="o">=</span>&gt;<span class="s2">"foo"</span><span class="o">}</span>
</pre>
<p>Done! <a href="https://gist.github.com/teamon/506390">Example gist</a></p>
</div></article><div class="page-header"><h2>Comments</h2></div><div class="alert alert-info">Please comment at the <a href="http://tumblr.teamon.eu/post/898063470/better-scoped-rails-engines-routing">original post</a>.</div><ul class="pager"><li class="next"><a href="/2010/2-5-times-faster-heckle">Older post →</a></li><li class="previous"><a href="/2010/quickly-get-some-random-image-placeholders">← Newer post</a></li></ul></div><footer><div class="container"><div class="page-header"></div><div class="row"><div class="col-md-12"><ul class="list-unstyled"><li class="pull-right"><a href="#top">Back to top ↑</a></li><li><a href="/">Blog</a></li><li><a href="/about.html">About</a></li><li><a href="/projects.html">Projects</a></li><li><a href="/talks.html">Talks</a></li><li>|</li><li><a href="http://github.com/teamon">GitHub</a></li><li><a href="http://twitter.com/iteamon">Twitter</a></li><li><a href="http://monterail.com">Monterail</a></li><li><a href="http://codetunes.com">Codetunes</a></li></ul></div></div><div class="row"><div class="col-md-12"><p>Copyright 2007-2014 &mdash; Tymon Tobolski <br />Based on <a href="http://bootswatch.com/lumen/">Lumen Bootswatch</a>. Web fonts from <a href="http://www.google.com/webfonts">Google</a>. </p></div></div></div></footer></body></html>